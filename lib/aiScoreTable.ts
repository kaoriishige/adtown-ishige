// ----------------------------------------------------------
// ★ AIマッチング 評価点数 計算表
// ----------------------------------------------------------
// 「lib/aiValueTemplate/」の全項目に対応する「点数」を定義します。
//
// 5点: 非常に強い差別化要因 (例: 自家製天然酵母、国家資格)
// 3点: 重要な差別化要因 (例: 地元食材、個室あり)
// 1点: 基本的な強み (例: 清潔感、駐車場)
// ----------------------------------------------------------

// 型定義
// ★★★ ここを修正 ★★★
// 階層が1つ（Record<string, number>）足りませんでした
type CategoryScores = Record<string, Record<string, Record<string, Record<string, number>>>>;
// ★★★ 修正ここまで ★★★

export const AI_SCORE_TABLE: CategoryScores = {
  
  // --- 飲食関連 ---
  "飲食関連": {
    "レストラン・食堂": {
      "料理の味や素材へのこだわり": {
        "地元那須の食材を厳選使用": 3,
        "無添加・オーガニック素材のみ": 5,
        "旬の食材を活かした日替わりメニュー": 3,
        "シェフ独自の創作料理が自慢": 5,
        "素材の味を活かすシンプルな調理": 1,
      },
      "スタッフの接客や雰囲気": {
        "活気があり明るい接客": 1,
        "落ち着いた空間で丁寧なおもてなし": 3,
        "記念日など特別なシーンの演出に対応": 5,
        "家族連れ・お子様歓迎の雰囲気": 3,
        "常連客との会話を大切にしている": 1,
      },
      "空間・設備のこだわり": {
        "店内・トイレ・厨房が常に清潔": 1,
        "席間が広くゆったり過ごせる": 1,
        "個室・半個室を完備している": 3,
        "那須の景色が望めるテラス席がある": 5,
        "バリアフリーに対応している": 3,
      },
      "価格と満足度のバランス": {
        "価格以上の満足感・ボリューム": 3,
        "高品質・適正価格を心がけている": 1,
        "ランチセットがお得": 1,
        "コース料理のコストパフォーマンスが高い": 3,
        "リピートしやすい価格設定": 1,
      },
      "お店の個性・特徴": {
        "特定のジャンル（例：イタリアン）を極めている": 5,
        "幅広い客層に対応できるメニュー数": 1,
        "アレルギー・ヴィーガン等に対応": 5,
        "ペット同伴可能（テラス席など）": 3,
        "駐車場が広くアクセスしやすい": 1,
      },
    },
    "パン屋（ベーカリー）": {
      "パンの製法・素材へのこだわり": {
        "自家製天然酵母を使用": 5,
        "国産小麦・地元産小麦を使用": 3,
        "無添加・オーガニック素材": 5,
        "焼きたての提供時間を告知している": 1,
        "伝統的な製法（石窯など）": 5,
      },
      "商品のラインナップ": {
        "食パン・バゲットなど食事パンが自慢": 3,
        "惣菜パン（調理パン）の種類が豊富": 1,
        "デニッシュ・菓子パンの種類が豊富": 1,
        "ハード系のパン（ドイツパンなど）に強い": 3,
        "アレルギー対応パン（グルテンフリー等）": 5,
      },
      "価格と満足度": {
        "日常的に買いやすい価格設定": 1,
        "素材の割にコストパフォーマンスが高い": 3,
        "お得な詰め合わせセットがある": 1,
        "ポイントカード・割引がある": 1,
        "高品質・適正価格": 3,
      },
      "店舗の雰囲気・サービス": {
        "イートインスペース・テラス席がある": 3,
        "コーヒーなどのドリンクも提供": 1,
        "スタッフがパンの特長を説明してくれる": 1,
        "予約・取り置きに対応": 1,
        "清潔感がありパンが選びやすい陳列": 1,
      },
      "お店の個性・特徴": {
        "早朝から営業している": 3,
        "駐車場が広くアクセスしやすい": 1,
        "ギフト・手土産セットがある": 1,
        "季節・イベント限定のパン": 3,
        "サンドイッチ・パニーニが充実": 1,
      },
    },
    // ... (他の飲食関連の小カテゴリも同様に定義) ...
  },

  // --- 美容・健康関連 ---
  "美容・健康関連": {
    "美容室": {
      "技術力・仕上がりの満足度": {
        "骨格・髪質に合わせた似合わせカット": 5,
        "透明感カラー・デザインカラーが得意": 3,
        "髪質改善・トリートメントに強い": 5,
        "再現性の高いスタイル（自宅でセットしやすい）": 3,
        "縮毛矯正・パーマの技術が高い": 3,
      },
      "カウンセリングの丁寧さ": {
        "悩みや要望を深くヒアリング": 3,
        "ライフスタイルに合わせた提案": 3,
        "施術内容・料金を事前に明確に説明": 1,
        "ヘアケアのアドバイスが的確": 1,
        "複数の選択肢を提案してくれる": 1,
      },
      "空間・雰囲気": {
        "落ち着いたプライベートサロン": 5,
        "ナチュラル・お洒落な内装": 3,
        "清潔感・衛生管理が徹底されている": 1,
        "フルフラットのシャンプー台でリラックス": 3,
        "カフェのような居心地の良い空間": 1,
      },
      "スタッフの人柄・対応": {
        "親しみやすく会話が楽しい": 1,
        "静かに過ごしたい要望を察してくれる": 3,
        "マンツーマン（一人が最後まで担当）": 5,
        "アシスタントの教育が行き届いている": 1,
        "常に笑顔で丁寧な対応": 1,
      },
      "価格と満足度": {
        "料金体系が明確で安心": 1,
        "高品質な薬剤・商材を使用": 3,
        "通いやすい価格設定（リピーター割など）": 1,
        "価格以上の価値・満足感": 3,
        "お得なクーポン・特典がある": 1,
      },
    },
    "整体・整骨院・鍼灸院": {
      "技術力・症状の改善": {
        "国家資格（柔道整復師・鍼灸師等）保有": 5,
        "痛みの根本原因を的確に診断": 5,
        "施術後に身体の変化・改善を実感": 3,
        "ボキボキしない優しい施術": 1,
        "鍼（はり）・お灸の技術が高い": 3,
      },
      "カウンセリング・説明の丁寧さ": {
        "症状・生活習慣を深くヒアリング": 3,
        "身体の状態・施術計画を分かりやすく説明": 3,
        "保険適用の可否を明確に説明": 1,
        "自宅でできるストレッチ・ケアを指導": 3,
        "複数の選択肢を提示してくれる": 1,
      },
      "院内の清潔感・雰囲気": {
        "院内・ベッド・タオルが常に清潔": 1,
        "衛生管理・感染対策が徹底": 3,
        "プライバシーに配慮（カーテン仕切り等）": 1,
        "明るくリラックスできる雰囲気": 1,
        "最新の治療機器が揃っている": 3,
      },
      "スタッフの対応": {
        "受付スタッフの対応が丁寧": 1,
        "先生が親身になって話を聞いてくれる": 3,
        "質問しやすい雰囲気": 1,
        "スタッフ間の連携が取れている": 1,
        "安心して任せられる信頼感": 3,
      },
      "利便性・通いやすさ": {
        "予約が取りやすい・待ち時間が少ない": 1,
        "土日祝日・夜間も対応": 3,
        "アクセスしやすい立地・駐車場完備": 1,
        "料金体系（保険・自費）が明確": 1,
        "継続して通いやすい": 1,
      },
    },
    // ... (他の美容・健康関連の小カテゴリも同様に定義) ...
  },

  // ... (他のすべての大カテゴリも同様に定義) ...
  
  // --- 汎用（その他） ---
  "その他": {
    "その他": { // 汎用の定義
      "サービスの品質・専門性": {
        "高品質なサービス・商品を提供": 3,
        "専門知識豊富なスタッフが対応": 5,
        "丁寧で確実な仕事": 1,
        "他社にはない独自の強み": 5,
        "顧客のニーズに合わせた柔軟な対応": 3,
      },
      // ... (他も同様に1, 3, 5点で点数付け) ...
      // (※注意: ここも中略しています。aiValueTemplate/99_other.ts の全項目を定義する必要があります)
      "スタッフの接客・対応": {
        "明るく丁寧な接客を心がけている": 1,
        "親身になって相談に乗ってくれる": 3,
        "迅速・スムーズな対応": 1,
        "説明が分かりやすい": 1,
        "安心感・信頼感のある対応": 3,
      },
      "店舗・オフィスの雰囲気": {
         "清潔感があり整理整頓されている": 1,
         "入りやすい・相談しやすい雰囲気": 1,
         "リラックスできる空間づくり": 3,
         "衛生管理・安全対策が徹底": 3,
         "アクセスしやすい立地": 1,
      },
      "価格と満足度": {
        "料金体系が明確で分かりやすい": 1,
        "価格以上の価値・満足感": 3,
        "適正価格での提供": 1,
        "予算に応じたプラン提案": 3,
        "コストパフォーマンスが高い": 3,
      },
      "信頼性・アフターフォロー": {
        "地元密着で信頼できる": 3,
        "納期や約束を厳守": 1,
        "アフターフォロー・サポートが充実": 5,
        "長期的な関係性を重視": 3,
        "万が一の際の保証・対応が万全": 5,
      },
    },
  },
};

/**
 * 点数を取得するヘルパー関数
 * @param mainCat (例: "飲食関連")
 * @param subCat (例: "パン屋（ベーカリー）")
 * @param option (例: "自家製天然酵母を使用")
 * @returns 点数 (見つからなければ 1 点)
 */
export const getScoreForOption = (mainCat: string, subCat: string, option: string): number => {
  try {
    // 1. 小カテゴリの定義を探す
    if (AI_SCORE_TABLE[mainCat] && AI_SCORE_TABLE[mainCat][subCat]) {
      const questions = AI_SCORE_TABLE[mainCat][subCat];
      // 2. 質問 -> 回答 をループして点数を探す
      for (const questionKey in questions) {
        if (questions[questionKey][option] !== undefined) {
          return questions[questionKey][option];
        }
      }
    }
    // 3.「その他」の汎用定義を探す
    if (AI_SCORE_TABLE["その他"] && AI_SCORE_TABLE["その他"]["その他"]) {
       const questions = AI_SCORE_TABLE["その他"]["その他"];
       for (const questionKey in questions) {
        if (questions[questionKey][option] !== undefined) {
          return questions[questionKey][option];
        }
      }
    }
    
    // どこにも定義がなければ、デフォルトで1点
    return 1;

  } catch (err) {
    console.error("Scoring Error:", err);
    return 1; // エラー時も1点
  }
};